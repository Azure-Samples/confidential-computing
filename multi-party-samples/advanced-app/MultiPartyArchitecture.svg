<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800">
  <defs>
    <linearGradient id="azureGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0078d4;stop-opacity:0.1"/>
      <stop offset="100%" style="stop-color:#0078d4;stop-opacity:0.05"/>
    </linearGradient>
    <linearGradient id="confGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#28a745;stop-opacity:0.15"/>
      <stop offset="100%" style="stop-color:#28a745;stop-opacity:0.08"/>
    </linearGradient>
    <linearGradient id="bankGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a472a;stop-opacity:0.15"/>
      <stop offset="100%" style="stop-color:#1a472a;stop-opacity:0.08"/>
    </linearGradient>
    <linearGradient id="stdGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc3545;stop-opacity:0.15"/>
      <stop offset="100%" style="stop-color:#dc3545;stop-opacity:0.08"/>
    </linearGradient>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#28a745"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc3545"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0078d4"/>
    </marker>
    <marker id="arrowBank" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1a472a"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="800" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="700" y="35" text-anchor="middle" font-family="Segoe UI, Arial" font-size="24" font-weight="bold" fill="#333">Multi-Party Confidential Computing - Architecture Overview</text>
  <text x="700" y="55" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" fill="#666">3 Confidential Containers Â· AKS Virtual Nodes Â· Nginx Reverse Proxy (ports 80/8081/8082)</text>
  
  <!-- Azure Cloud boundary -->
  <rect x="30" y="70" width="1340" height="710" rx="15" fill="url(#azureGrad)" stroke="#0078d4" stroke-width="2" stroke-dasharray="8,4"/>
  <text x="50" y="95" font-family="Segoe UI, Arial" font-size="14" fill="#0078d4" font-weight="bold">â˜ï¸ Azure Cloud</text>
  
  <!-- Key Vaults Row -->
  <!-- Contoso Key Vault -->
  <g filter="url(#shadow)">
    <rect x="60" y="115" width="180" height="100" rx="10" fill="#fff" stroke="#0078d4" stroke-width="2"/>
    <rect x="60" y="115" width="180" height="28" rx="10" fill="#0078d4"/>
    <text x="150" y="134" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#fff" font-weight="bold">ğŸ” Contoso Key Vault</text>
    <text x="150" y="158" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">kv&lt;registry&gt;a</text>
    <text x="150" y="175" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#666">ğŸ”‘ contoso-secret-key</text>
    <text x="150" y="192" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#888">RSA-HSM + Release Policy</text>
  </g>
  
  <!-- Fabrikam Key Vault -->
  <g filter="url(#shadow)">
    <rect x="260" y="115" width="180" height="100" rx="10" fill="#fff" stroke="#0078d4" stroke-width="2"/>
    <rect x="260" y="115" width="180" height="28" rx="10" fill="#0078d4"/>
    <text x="350" y="134" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#fff" font-weight="bold">ğŸ” Fabrikam Key Vault</text>
    <text x="350" y="158" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">kv&lt;registry&gt;b</text>
    <text x="350" y="175" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#666">ğŸ”‘ fabrikam-secret-key</text>
    <text x="350" y="192" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#888">RSA-HSM + Release Policy</text>
  </g>
  
  <!-- Woodgrove Key Vault -->
  <g filter="url(#shadow)">
    <rect x="460" y="115" width="180" height="100" rx="10" fill="#fff" stroke="#1a472a" stroke-width="2"/>
    <rect x="460" y="115" width="180" height="28" rx="10" fill="#1a472a"/>
    <text x="550" y="134" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#fff" font-weight="bold">ğŸ¦ Woodgrove Key Vault</text>
    <text x="550" y="158" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">kv&lt;registry&gt;c</text>
    <text x="550" y="175" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#666">ğŸ”‘ woodgrove-secret-key</text>
    <text x="550" y="192" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#888">+ Partner Access</text>
  </g>
  
  <!-- MAA -->
  <g filter="url(#shadow)">
    <rect x="680" y="115" width="180" height="70" rx="10" fill="#fff" stroke="#0078d4" stroke-width="2"/>
    <rect x="680" y="115" width="180" height="25" rx="10" fill="#0078d4"/>
    <text x="770" y="133" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#fff" font-weight="bold">ğŸ›¡ï¸ Azure Attestation</text>
    <text x="770" y="155" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">sharedeus.eus.attest</text>
    <text x="770" y="172" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">.azure.net</text>
  </g>
  
  <!-- User -->
  <g filter="url(#shadow)">
    <rect x="900" y="115" width="120" height="70" rx="10" fill="#fff" stroke="#6c757d" stroke-width="2"/>
    <text x="960" y="145" text-anchor="middle" font-family="Segoe UI, Arial" font-size="24">ğŸ‘¤</text>
    <text x="960" y="170" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#333" font-weight="bold">User Browser</text>
  </g>
  
  <!-- Nginx Proxy (AKS mode) -->
  <g filter="url(#shadow)">
    <rect x="1060" y="115" width="180" height="100" rx="10" fill="#fff" stroke="#6c757d" stroke-width="2"/>
    <rect x="1060" y="115" width="180" height="28" rx="10" fill="#6c757d"/>
    <text x="1150" y="134" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#fff" font-weight="bold">ğŸŒ Nginx Reverse Proxy</text>
    <text x="1150" y="158" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#333">LoadBalancer Service</text>
    <text x="1150" y="174" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#28a745">:80 â†’ Woodgrove ğŸ¦</text>
    <text x="1150" y="188" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#28a745">:8081 â†’ Contoso ğŸ¢</text>
    <text x="1150" y="202" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#28a745">:8082 â†’ Fabrikam ğŸ‘—</text>
  </g>
  
  <!-- User to Nginx Proxy -->
  <line x1="1020" y1="150" x2="1055" y2="150" stroke="#6c757d" stroke-width="1.5" marker-end="url(#arrowBlue)"/>
  
  <!-- Nginx to Contoso -->
  <path d="M 1060 200 Q 700 260 340 280" stroke="#6c757d" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="700" y="230" font-family="Segoe UI, Arial" font-size="8" fill="#6c757d">:8081</text>
  
  <!-- Nginx to Fabrikam -->
  <path d="M 1090 215 Q 800 260 650 280" stroke="#6c757d" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="880" y="252" font-family="Segoe UI, Arial" font-size="8" fill="#6c757d">:8082</text>
  
  <!-- Nginx to Woodgrove -->
  <path d="M 1150 215 Q 1050 260 960 280" stroke="#6c757d" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="1070" y="252" font-family="Segoe UI, Arial" font-size="8" fill="#6c757d">:80</text>
  
  <!-- ========== CONTAINERS ========== -->
  
  <!-- Contoso Container -->
  <g filter="url(#shadow)">
    <rect x="60" y="280" width="280" height="200" rx="10" fill="url(#confGrad)" stroke="#28a745" stroke-width="2"/>
    <rect x="60" y="280" width="280" height="32" rx="10" fill="#28a745"/>
    <text x="200" y="302" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" fill="#fff" font-weight="bold">ğŸ¢ Contoso (Confidential)</text>
    <rect x="80" y="322" width="240" height="45" rx="5" fill="#d4edda" stroke="#28a745"/>
    <text x="200" y="342" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#155724">ğŸ”’ AMD SEV-SNP TEE</text>
    <text x="200" y="358" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#155724">Hardware Memory Encryption</text>
    <rect x="80" y="377" width="110" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="135" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">Flask :80</text>
    <rect x="200" y="377" width="120" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="260" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">SKR :8080</text>
    <text x="200" y="440" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#28a745" font-weight="bold">âœ… Can Attest &amp; Get Own Key</text>
    <text x="200" y="458" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#666">Identity: id-&lt;registry&gt;-contoso</text>
  </g>
  
  <!-- Fabrikam Container -->
  <g filter="url(#shadow)">
    <rect x="370" y="280" width="280" height="200" rx="10" fill="url(#confGrad)" stroke="#28a745" stroke-width="2"/>
    <rect x="370" y="280" width="280" height="32" rx="10" fill="#28a745"/>
    <text x="510" y="302" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" fill="#fff" font-weight="bold">ğŸ‘— Fabrikam Fashion (Confidential)</text>
    <rect x="390" y="322" width="240" height="45" rx="5" fill="#d4edda" stroke="#28a745"/>
    <text x="510" y="342" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#155724">ğŸ”’ AMD SEV-SNP TEE</text>
    <text x="510" y="358" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#155724">Hardware Memory Encryption</text>
    <rect x="390" y="377" width="110" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="445" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">Flask :80</text>
    <rect x="510" y="377" width="120" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="570" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">SKR :8080</text>
    <text x="510" y="440" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#28a745" font-weight="bold">âœ… Can Attest &amp; Get Own Key</text>
    <text x="510" y="458" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#666">Identity: id-&lt;registry&gt;-fabrikam</text>
  </g>
  
  <!-- Woodgrove Bank Container -->
  <g filter="url(#shadow)">
    <rect x="680" y="280" width="280" height="200" rx="10" fill="url(#bankGrad)" stroke="#1a472a" stroke-width="2"/>
    <rect x="680" y="280" width="280" height="32" rx="10" fill="#1a472a"/>
    <text x="820" y="302" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" fill="#fff" font-weight="bold">ğŸ¦ Woodgrove Bank (Confidential)</text>
    <rect x="700" y="322" width="240" height="45" rx="5" fill="#d4edda" stroke="#1a472a"/>
    <text x="820" y="342" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#155724">ğŸ”’ AMD SEV-SNP TEE</text>
    <text x="820" y="358" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#155724">Hardware Memory Encryption</text>
    <rect x="700" y="377" width="110" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="755" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">Flask :80</text>
    <rect x="820" y="377" width="120" height="35" rx="5" fill="#fff" stroke="#666"/>
    <text x="880" y="400" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#333">SKR :8080</text>
    <text x="820" y="440" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#1a472a" font-weight="bold">âœ… Can Attest + Partner Keys</text>
    <text x="820" y="458" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#666">Identity: id-&lt;registry&gt;-woodgrove</text>
  </g>
  
  <!-- ========== ARROWS ========== -->
  
  <!-- Contoso to Key Vault -->
  <path d="M 200 280 L 150 220" stroke="#28a745" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="155" y="250" font-family="Segoe UI, Arial" font-size="9" fill="#28a745">âœ… Key</text>
  
  <!-- Fabrikam to Key Vault -->
  <path d="M 510 280 L 350 220" stroke="#28a745" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="415" y="250" font-family="Segoe UI, Arial" font-size="9" fill="#28a745">âœ… Key</text>
  
  <!-- Woodgrove to Own Key Vault -->
  <path d="M 820 280 L 550 220" stroke="#1a472a" stroke-width="2" fill="none" marker-end="url(#arrowBank)"/>
  <text x="670" y="248" font-family="Segoe UI, Arial" font-size="9" fill="#1a472a">âœ… Own Key</text>
  
  <!-- Woodgrove to Contoso Key Vault (Partner) -->
  <path d="M 750 280 Q 400 240 200 215" stroke="#1a472a" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowBank)"/>
  <text x="470" y="230" font-family="Segoe UI, Arial" font-size="8" fill="#1a472a">Partner Access</text>
  
  <!-- Woodgrove to Fabrikam Key Vault (Partner) -->
  <path d="M 780 280 Q 550 250 400 215" stroke="#1a472a" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowBank)"/>
  
  <!-- User to containers (via nginx proxy - see proxy arrows above) -->
  
  <!-- ========== LEGEND ========== -->
  <rect x="60" y="520" width="600" height="240" rx="10" fill="#fff" stroke="#dee2e6" stroke-width="1"/>
  <text x="80" y="545" font-family="Segoe UI, Arial" font-size="14" fill="#333" font-weight="bold">Legend - Access Control Matrix</text>
  
  <!-- Access Matrix Table -->
  <text x="80" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">Container</text>
  <text x="200" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">TEE?</text>
  <text x="270" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">Own Key</text>
  <text x="360" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">Contoso Key</text>
  <text x="460" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">Fabrikam Key</text>
  <text x="560" y="575" font-family="Segoe UI, Arial" font-size="10" fill="#333" font-weight="bold">Woodgrove Key</text>
  
  <!-- Contoso row -->
  <text x="80" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">Contoso</text>
  <text x="200" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="270" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="360" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="460" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#dc3545">âŒ</text>
  <text x="560" y="600" font-family="Segoe UI, Arial" font-size="10" fill="#dc3545">âŒ</text>
  
  <!-- Fabrikam row -->
  <text x="80" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">Fabrikam</text>
  <text x="200" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="270" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="360" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#dc3545">âŒ</text>
  <text x="460" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="560" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#dc3545">âŒ</text>
  
  <!-- Woodgrove row -->
  <text x="80" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#1a472a">Woodgrove Bank</text>
  <text x="200" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="270" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  <text x="360" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#1a472a">âœ…*</text>
  <text x="460" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#1a472a">âœ…*</text>
  <text x="560" y="640" font-family="Segoe UI, Arial" font-size="10" fill="#28a745">âœ…</text>
  
  <text x="80" y="675" font-family="Segoe UI, Arial" font-size="9" fill="#1a472a">* Partner access granted via explicit Key Vault policy</text>
  
  <!-- Key points -->
  <text x="80" y="720" font-family="Segoe UI, Arial" font-size="11" fill="#333" font-weight="bold">Key Security Points:</text>
  <text x="80" y="740" font-family="Segoe UI, Arial" font-size="10" fill="#333">â€¢ All containers run identical code from the same image</text>
  <text x="80" y="755" font-family="Segoe UI, Arial" font-size="10" fill="#333">â€¢ Only Confidential SKU containers have /dev/sev-guest device</text>
  
  <!-- Data Flow Box -->
  <rect x="680" y="520" width="590" height="240" rx="10" fill="#fff" stroke="#dee2e6" stroke-width="1"/>
  <text x="700" y="545" font-family="Segoe UI, Arial" font-size="14" fill="#333" font-weight="bold">Traffic Flow Summary</text>
  
  <line x1="700" y1="565" x2="750" y2="565" stroke="#28a745" stroke-width="3"/>
  <text x="765" y="570" font-family="Segoe UI, Arial" font-size="10" fill="#333">Confidential â†’ Key Vault (own key)</text>
  
  <line x1="700" y1="590" x2="750" y2="590" stroke="#1a472a" stroke-width="2" stroke-dasharray="4,2"/>
  <text x="765" y="595" font-family="Segoe UI, Arial" font-size="10" fill="#333">Woodgrove â†’ Partner Key Vaults (explicit access)</text>
  
  <line x1="700" y1="615" x2="750" y2="615" stroke="#6c757d" stroke-width="2" stroke-dasharray="4,2"/>
  <text x="765" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#333">Nginx Proxy â†’ Containers (:80 Woodgrove, :8081 Contoso, :8082 Fabrikam)</text>
  
  <text x="700" y="640" font-family="Segoe UI, Arial" font-size="11" fill="#333" font-weight="bold">Woodgrove Bank Partner Analysis:</text>
  <text x="700" y="660" font-family="Segoe UI, Arial" font-size="10" fill="#333">1. Woodgrove passes TEE attestation (AMD SEV-SNP)</text>
  <text x="700" y="678" font-family="Segoe UI, Arial" font-size="10" fill="#333">2. MAA issues JWT token for Woodgrove container</text>
  <text x="700" y="696" font-family="Segoe UI, Arial" font-size="10" fill="#333">3. Contoso &amp; Fabrikam Key Vaults verify JWT + identity</text>
  <text x="700" y="714" font-family="Segoe UI, Arial" font-size="10" fill="#333">4. Partner keys released to Woodgrove TEE memory</text>
</svg>
